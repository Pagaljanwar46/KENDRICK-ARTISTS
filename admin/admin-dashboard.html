

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard | Artist Management</title>
  <style>
    /* Modern Reset & Base Styles */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { 
        font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
        background-color: #f4f7f9; 
        color: #333; 
        line-height: 1.6;
        padding: 0;
    }

    /* Layout Container */
    .container {
        max-width: 1000px;
        margin: 40px auto;
        padding: 0 20px;
    }

    /* Header Section */
    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        border-bottom: 2px solid #3498db;
        padding-bottom: 10px;
    }
    
    .header h1 { color: #2c3e50; font-size: 24px; }

    /* Form Card Styling */
    .card {
        background: #fff;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        margin-bottom: 40px;
    }

    .card h2 { margin-bottom: 20px; font-size: 18px; color: #555; text-transform: uppercase; letter-spacing: 1px; }

    .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }

    input, textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        outline: none;
        transition: border-color 0.2s;
    }

    input:focus, textarea:focus { border-color: #3498db; }

    textarea { grid-column: span 2; height: 100px; resize: vertical; }

    .checkbox-group {
        grid-column: span 2;
        display: flex;
        align-items: center;
        gap: 10px;
        margin: 5px 0;
    }

    .checkbox-group input { width: auto; margin: 0; }

    /* Buttons */
    button {
        cursor: pointer;
        padding: 10px 18px;
        border: none;
        border-radius: 4px;
        font-weight: 600;
        transition: all 0.2s ease;
    }

    #saveBtn {
        background-color: #27ae60;
        color: white;
        width: 100%;
        font-size: 16px;
        margin-top: 10px;
    }

    #saveBtn:hover { background-color: #219150; transform: translateY(-1px); }
    
    .btn-logout { background: #95a5a6; color: white; font-size: 12px; }

    /* Artist List Styling */
    .artist-item {
        background: #fff;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        margin-bottom: 12px;
        border-radius: 6px;
        border-left: 5px solid #3498db;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    .artist-info { flex-grow: 1; }
    .artist-info strong { font-size: 1.1em; color: #2c3e50; }

    .status-badge {
        font-size: 11px;
        padding: 3px 10px;
        border-radius: 20px;
        margin-left: 10px;
        font-weight: bold;
        text-transform: uppercase;
    }

    .active-bg { background: #e8f5e9; color: #2e7d32; }
    .inactive-bg { background: #ffebee; color: #c62828; }

    /* Action Buttons */
    .actions { display: flex; gap: 8px; }
    .btn-edit { background: #3498db; color: white; }
    .btn-delete { background: #e74c3c; color: white; }
    .btn-toggle { background: #f39c12; color: white; }

    button:hover { opacity: 0.9; }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .form-grid { grid-template-columns: 1fr; }
        textarea { grid-column: span 1; }
        .artist-item { flex-direction: column; align-items: flex-start; }
        .actions { margin-top: 15px; width: 100%; justify-content: flex-start; }
    }
  </style>
</head>
<body>

  <div class="container">
    <div class="header">
        <h1>Admin Dashboard</h1>
        <button class="btn-logout" id="logoutBtn">Logout</button>
    </div>

    <div class="card">
        <h2>Add / Edit Artist</h2>
        <div class="form-grid">
            <input id="name" placeholder="Artist Name">
            <input id="slug" placeholder="URL Slug (e.g. kendrick-lamar)">
            <input id="category" placeholder="Category (e.g. West Coast)">
            <select id="section">
  <option value="">Select Section</option>
  <option value="personal">Personal Appearance</option>
  <option value="comedy">Comedy</option>
</select>

            <input id="imageUrl" placeholder="Image URL">
            <textarea id="bio" placeholder="Artist Biography"></textarea>
            <input id="videoUrl" placeholder="Video URL (YouTube Embed)">
<input id="galleryImages" placeholder="Gallery Images (comma-separated URLs)">
<textarea id="bioAfterVideo" placeholder="Text after video"></textarea>

<textarea id="bioAfterImage1" placeholder="Text after first image"></textarea>

<textarea id="bioAfterImage2" placeholder="Text after second image"></textarea>


            <div class="checkbox-group">
                <input type="checkbox" id="active">
                <label for="active">Set as Active (Visible on site)</label>
            </div>
        </div>
        <button id="saveBtn">Save Artist</button>
    </div>

    <h2>Artists List</h2>
    <div id="artistsList"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";
    import { 
      getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, getDoc, serverTimestamp 
    } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAGbc3hE5qsN8axCsRNaNH4CNSDp3Yave8",
      authDomain: "kendrick-artists-clarck.firebaseapp.com",
      projectId: "kendrick-artists-clarck",
      storageBucket: "kendrick-artists-clarck.firebasestorage.app",
      messagingSenderId: "695415417830",
      appId: "1:695415417830:web:f5d196cdf9334f80220427"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const db = getFirestore();

    // Protect admin page
    onAuthStateChanged(auth, (user) => {
      if (!user) window.location.href = "admin-login.html";
    });

    // Logout Functionality
    document.getElementById("logoutBtn").addEventListener("click", () => {
        signOut(auth).then(() => window.location.href = "admin-login.html");
    });

    const saveBtn = document.getElementById("saveBtn");
    let currentEditId = null;

    // Load all artists
    async function loadArtists() {
      const artistsList = document.getElementById("artistsList");
      artistsList.innerHTML = "<p>Loading artists...</p>";
      
      try {
          const snapshot = await getDocs(collection(db, "artists"));
          artistsList.innerHTML = ""; // Clear loader
          
          snapshot.forEach(docSnap => {
            const artist = docSnap.data();
            const div = document.createElement("div");
            div.className = "artist-item";
            div.innerHTML = `
              <div class="artist-info">
                <strong>${artist.name}</strong>
                <span class="status-badge ${artist.active ? 'active-bg' : 'inactive-bg'}">
                    ${artist.active ? "Active" : "Inactive"}
                </span>
                <div style="font-size: 12px; color: #888;">/${artist.slug}</div>
              </div>
              <div class="actions">
                <button class="btn-edit" onclick="editArtist('${docSnap.id}')">Edit</button>
                <button class="btn-toggle" onclick="toggleActive('${docSnap.id}')">
                    ${artist.active ? "Deactivate" : "Activate"}
                </button>
                <button class="btn-delete" onclick="deleteArtist('${docSnap.id}')">Delete</button>
              </div>
            `;
            artistsList.appendChild(div);
          });
      } catch (err) {
          artistsList.innerHTML = "Error loading artists: " + err.message;
      }
    }

    // Add or Update Artist
    saveBtn.addEventListener("click", async () => {
      const name = document.getElementById("name").value.trim();
      const slug = document.getElementById("slug").value.trim();
      const bio = document.getElementById("bio").value.trim();
      const imageUrl = document.getElementById("imageUrl").value.trim();
      const category = document.getElementById("category").value.trim();
      const active = document.getElementById("active").checked;
      const section = document.getElementById("section").value;
      const videoUrl = document.getElementById("videoUrl").value.trim();
const galleryInput = document.getElementById("galleryImages").value.trim();
const galleryImages = galleryInput ? galleryInput.split(",").map(url => url.trim()) : [];
const bioAfterVideo = document.getElementById("bioAfterVideo").value.trim();
const bioAfterImage1 = document.getElementById("bioAfterImage1").value.trim();
const bioAfterImage2 = document.getElementById("bioAfterImage2").value.trim();




      if (!section) {
  alert("Please select a section.");
  return;
}


      saveBtn.disabled = true;
      saveBtn.textContent = "Processing...";

      try {
        if (currentEditId) {
          const docRef = doc(db, "artists", currentEditId);
          await updateDoc(docRef, { name, slug, bio, imageUrl, category, section, active, videoUrl: videoUrl || null, bioAfterVideo: bioAfterVideo || null,
bioAfterImage1: bioAfterImage1 || null,
bioAfterImage2: bioAfterImage2 || null, galleryImages: galleryImages.length ? galleryImages : null,
updatedAt: serverTimestamp() });
          alert("Artist updated successfully!");
          currentEditId = null;
          saveBtn.textContent = "Save Artist";
        } else {
          await addDoc(collection(db, "artists"), { name, slug, bio, imageUrl, category, section, bioAfterVideo: bioAfterVideo || null,
bioAfterImage1: bioAfterImage1 || null,
bioAfterImage2: bioAfterImage2 || null,
active, createdAt: serverTimestamp(), updatedAt: serverTimestamp() });
          alert("Artist added successfully!");
        }
        
        // Clear form
        document.getElementById("name").value = "";
        document.getElementById("slug").value = "";
        document.getElementById("bio").value = "";
        document.getElementById("imageUrl").value = "";
        document.getElementById("category").value = "";
        document.getElementById("active").checked = false;
        document.getElementById("section").value = "";
        document.getElementById("videoUrl").value = "";
        document.getElementById("galleryImages").value = "";
        document.getElementById("bioAfterVideo").value = "";
        document.getElementById("bioAfterImage1").value = "";
        document.getElementById("bioAfterImage2").value = "";


        
        loadArtists();
      } catch (err) {
        alert("Error: " + err.message);
      } finally {
          saveBtn.disabled = false;
          if(!currentEditId) saveBtn.textContent = "Save Artist";
      }
    });

    // Global Window Functions for the buttons
    window.editArtist = async (id) => {
      try {
        const docRef = doc(db, "artists", id);
        const docSnap = await getDoc(docRef);
        const artist = docSnap.data();

        document.getElementById("name").value = artist.name;
        document.getElementById("slug").value = artist.slug;
        document.getElementById("bio").value = artist.bio;
        document.getElementById("imageUrl").value = artist.imageUrl;
        document.getElementById("category").value = artist.category;
        document.getElementById("active").checked = artist.active;
        document.getElementById("section").value = artist.section;
        document.getElementById("videoUrl").value = artist.videoUrl || "";
document.getElementById("galleryImages").value = artist.galleryImages ? artist.galleryImages.join(", ") : "";
document.getElementById("bioAfterVideo").value = artist.bioAfterVideo || "";
document.getElementById("bioAfterImage1").value = artist.bioAfterImage1 || "";
document.getElementById("bioAfterImage2").value = artist.bioAfterImage2 || "";




        currentEditId = id;
        saveBtn.textContent = "Update Artist";
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } catch (err) {
        alert("Error fetching artist: " + err.message);
      }
    };

    window.deleteArtist = async (id) => {
      if (!confirm("Are you sure you want to delete this artist?")) return;
      try {
        await deleteDoc(doc(db, "artists", id));
        loadArtists();
      } catch (err) {
        alert("Error deleting: " + err.message);
      }
    };

    window.toggleActive = async (id) => {
      try {
        const docRef = doc(db, "artists", id);
        const snap = await getDoc(docRef);
        const currentState = snap.data().active;
        await updateDoc(docRef, { active: !currentState, updatedAt: serverTimestamp() });
        loadArtists();
      } catch (err) {
        alert("Error toggling status: " + err.message);
      }
    };

    loadArtists();
  </script>
</body>
</html>